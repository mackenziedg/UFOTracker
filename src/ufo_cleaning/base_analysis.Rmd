---
title: Analysis of USAF base locations, state populations, and UFO sightings
author: Mackenzie Gray
---

First import all of the necessary packages

```{r, message=F, warning=F}
library(plyr)
library(tidyverse)
library(ggplot2)
library(ggrepel)
library(lubridate)
library(zoo)
```

Next, read in the necessary data.
`sightings` is the ufo sighting records from NUFORC, `base_locs` location information about USAF bases in the US,
`name_to_abbr` a mapping of US state names to abbreviations, and `stat_pops` US Census population data per state per decade from 1960 to 2010. 

```{r, message=F, warning=F}
sightings <- read_csv("../../data/raw/ufo_sightings.csv")
base_locs <- read_csv("../../data/raw/usaf_base_locs.csv")
state_pops <- read_csv("../../data/raw/state_pops.csv")
```

Next, transform and select the relevant data.

```{r}
sightings <- sightings  %>%
    filter(X1 < 109088) %>%
    filter(state %in% state.abb)

state_pops$Name <- mapvalues(state_pops$Name, state.name, state.abb)
state_pops <- state_pops %>%
    filter(Name %in% state.abb) %>%
    select(one_of(c("1970", "1980", "1990", "2000", "2010"))) %>%
    apply(1, mean)

sightings <- sightings  %>%
    group_by(state) %>%
    count()

base_locs <- base_locs  %>%
    group_by(State) %>%
    count() %>%
    merge(state.abb, by.x="State", by.y=1, all=T) %>%
    mutate(n=replace(n, is.na(n), 0)) %>%
    filter(!is.na(State))

df <- data.frame(sightings=sightings$n, base_count=base_locs$n, pop=state_pops, name=state.abb)

```

## Statistical analysis
Now that the data is all clean and together, we can begin analysis. 

### State populations vs number of sightings

Although these two variables seems obviously related, it is good practice to double check assumptions.

```{r}
(s <- summary(fit1 <- lm(sightings ~ pop, data=df)))
```

Given $R^2 = `r round(s$r.squared, 3)`$, $\beta_{pop} = `r round(s$coefficients[[2, 1]], 5)`$, and a 95% confidence interval for $\beta_{pop} = (`r round(confint(fit1)[2,1], 5)`, `r round(confint(fit1)[2,2], 5)`)$, we can be reasonably confident that a positive correlation does exist between the number of reported UFO sightings in a state since 1974 and the mean population of that state since 1970.

We can plot this relationship using `ggplot`.

```{r}
ggplot(data=df, aes(x=pop, y=sightings)) + geom_point() + stat_smooth(method='lm', se=F)
```

A number of obvious outliers are noticeable, but otherwise the relationship appears linear. We can graphically futher verify the assumptions of the least squares regression we performed.

```{r}
plot(fit1)
```

From the Q-Q plot, we can see that the errors do not appear to be normally distributed, with very large deviations from normal at either end. Additionally, two major outliers with IDs 5 and 32 are visible on the plot of residuals vs leverage. We can identify which states have the largest prediction error.

```{r}
(top_resid <- fit1$residuals  %>%
    abs() %>%
    order(decreasing=T) %>%
    head(7) %>%
    df[., "name"])


ggplot(data=df, aes(x=pop, y=sightings)) +
    geom_point() +
    stat_smooth(method='lm', se=F) +
    geom_text_repel(aes(label=name), data=df[df$name %in% top_resid,])

```
